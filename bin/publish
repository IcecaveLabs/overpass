#!/usr/bin/env php
<?php
require __DIR__ . '/../vendor/autoload.php';

use Icecave\Overpass\Amqp\AmqpPubSubClient;

$connection = new AMQPConnection(
    [
        'host' => 'localhost',
        'port' => 5672,
    ]
);

$connection->connect();

$pubSub = new AmqpPubSubClient($connection);

$counter = 0;
while (true) {
    $pubSub->publish($counter % 2 ? 'foo' : 'bar', $counter);
    echo 'P' . $counter++ . PHP_EOL;
}
